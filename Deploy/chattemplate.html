<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Render Chatbot Response</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 1rem;
    background: #f9f9f9;
    color: #222;
  }
  pre#raw-content {
    display: none;
  }
  .container {
    max-width: 800px;
    margin: auto;
  }
  /* Style cho pháº§n toggle */
  .toggle-section {
    border-left: 3px solid #007acc;
    padding-left: 0.8rem;
    margin-bottom: 1rem;
    cursor: pointer;
    user-select: none;
  }
  .toggle-header {
    display: flex;
    align-items: center;
    gap: 0.4rem;
    font-weight: 600;
    color: #007acc;
  }
  .toggle-arrow {
    transition: transform 0.2s ease;
    font-weight: bold;
    user-select: none;
  }
  .toggle-arrow.closed {
    transform: rotate(0deg);
  }
  .toggle-arrow.open {
    transform: rotate(90deg);
  }
  .toggle-content {
    margin-top: 0.5rem;
    padding-left: 1.2rem;
    color: #555;
    font-size: 0.9rem;
    max-height: 300px;
    overflow: auto;
    transition: color 0.3s ease;
  }
  .toggle-content.closed {
    color: #aaa;
    max-height: 3.5em; /* chá»‰ hiá»‡n 1 dÃ²ng + lÃ m má» */
    overflow: hidden;
  }
  /* Style cho pháº§n answer */
  .answer {
    background: white;
    border-radius: 6px;
    padding: 1rem 1.2rem;
    box-shadow: 0 2px 8px rgb(0 0 0 / 0.1);
    font-size: 1rem;
    white-space: pre-wrap;
  }
  /* Style markdown cÄƒn báº£n */
  .answer h1, .answer h2, .answer h3, .answer h4 {
    margin: 0.6rem 0 0.3rem;
  }
  .answer ul, .answer ol {
    margin-left: 1.2rem;
  }
  .answer code {
    background-color: #eee;
    padding: 0.1rem 0.3rem;
    border-radius: 3px;
    font-family: monospace;
    font-size: 0.95rem;
  }
  .answer blockquote {
    border-left: 4px solid #ccc;
    margin-left: 0;
    padding-left: 1rem;
    color: #666;
    font-style: italic;
  }
</style>
</head>
<body>
<div class="container">

  <!-- Raw input here for example -->
  <pre id="raw-content">
&lt;ï½œthinkï½œ&gt;
HÃ£y cÃ¹ng diá»…n giáº£i tá»«ng bÆ°á»›c nÃ o!ğŸ¤”
&lt;reasoning_cot&gt;
# ğŸ§  Suy luáº­n cá»§a MÃ¬nh
## 1ï¸âƒ£ Má»¥c tiÃªu ğŸ“Œ
XÃ¡c Ä‘á»‹nh nguyÃªn nhÃ¢n chÃ­nh gÃ¢y sÃ¢u rÄƒng dá»±a trÃªn báº±ng chá»©ng khoa há»c hiá»‡n cÃ³ vÃ  giáº£i thÃ­ch má»™t cÃ¡ch dá»… hiá»ƒu cho bá»‡nh nhÃ¢n.
## 2ï¸âƒ£ BÆ°á»›c suy nghÄ© âš™ï¸
BÆ°á»›c 1: PhÃ¢n tÃ­ch ngá»¯ cáº£nh: Ngá»¯ cáº£nh Ä‘á» cáº­p Ä‘áº¿n cÃ¡c nghiÃªn cá»©u vá» vi khuáº©n Streptococcus mutans vÃ  vai trÃ² cá»§a chÃºng trong sá»± phÃ¡t triá»ƒn sÃ¢u rÄƒng.  NghiÃªn cá»©u cho tháº¥y sá»± hiá»‡n diá»‡n cá»§a S. mutans lÃ  yáº¿u tá»‘ tiÃªn quyáº¿t.
BÆ°á»›c 2: XÃ¡c Ä‘á»‹nh má»‘i liÃªn há»‡:  NghiÃªn cá»©u chá»‰ ra ráº±ng S. mutans táº¡o ra acid tá»« Ä‘Æ°á»ng trong thá»©c Äƒn, lÃ m giáº£m pH trong miá»‡ng, gÃ¢y tá»•n thÆ°Æ¡ng men rÄƒng.
BÆ°á»›c 3: Káº¿t luáº­n:  Máº·c dÃ¹ cÃ³ nhiá»u yáº¿u tá»‘ khÃ¡c cÃ³ thá»ƒ gÃ³p pháº§n vÃ o sá»± phÃ¡t triá»ƒn sÃ¢u rÄƒng, nhÆ°ng S. mutans vÃ  acid do chÃºng táº¡o ra lÃ  yáº¿u tá»‘ chÃ­nh.
BÆ°á»›c 4:  Xem xÃ©t cÃ¡c yáº¿u tá»‘ khÃ¡c:  Máº·c dÃ¹ S. mutans lÃ  yáº¿u tá»‘ chÃ­nh,  cÃ¡c yáº¿u tá»‘ khÃ¡c nhÆ° vá»‡ sinh rÄƒng miá»‡ng kÃ©m, cháº¿ Ä‘á»™ Äƒn nhiá»u Ä‘Æ°á»ng, di truyá»n cÅ©ng Ä‘Ã³ng vai trÃ² quan trá»ng.
## 3ï¸âƒ£ Giáº£i thÃ­ch ğŸ“
Sá»± hiá»‡n diá»‡n cá»§a Streptococcus mutans trong khoang miá»‡ng lÃ  yáº¿u tá»‘ tiÃªn quyáº¿t gÃ¢y sÃ¢u rÄƒng.  Vi khuáº©n nÃ y chuyá»ƒn hÃ³a Ä‘Æ°á»ng thÃ nh acid, lÃ m giáº£m pH trong miá»‡ng, phÃ¡ há»§y men rÄƒng vÃ  ngÃ  rÄƒng.  CÃ¡c yáº¿u tá»‘ khÃ¡c nhÆ° vá»‡ sinh rÄƒng miá»‡ng kÃ©m, cháº¿ Ä‘á»™ Äƒn nhiá»u Ä‘Æ°á»ng vÃ  di truyá»n cÅ©ng gÃ³p pháº§n lÃ m tÄƒng nguy cÆ¡ sÃ¢u rÄƒng.
&lt;/reasoning_cot&gt;
&lt;ï½œexpertï½œ&gt;
&lt;experting&gt;
# ğŸ‘¨â€ğŸ”¬ ChuyÃªn gia
## TrÃ¬nh bÃ y dáº¡ng: Biá»ƒu Ä‘á»“
## Ná»™i dung vá»: Äiá»u trá»‹
## ChuyÃªn sÃ¢u vá»: Tiá»ƒu pháº«u rÄƒng
&lt;/experting&gt;
&lt;ï½œassistantï½œ&gt;
&lt;answer&gt;
# ğŸ’¬ CÃ¢u tráº£ lá»i
ChÃ o báº¡n! NguyÃªn nhÃ¢n chÃ­nh gÃ¢y sÃ¢u rÄƒng lÃ  do vi khuáº©n Streptococcus mutans.  Vi khuáº©n nÃ y trong miá»‡ng chuyá»ƒn hÃ³a Ä‘Æ°á»ng tá»« thá»©c Äƒn thÃ nh acid, lÃ m giáº£m Ä‘á»™ pH trong miá»‡ng.  Khi pH giáº£m, axit sáº½ táº¥n cÃ´ng men rÄƒng vÃ  ngÃ  rÄƒng, gÃ¢y ra cÃ¡c lá»— sÃ¢u rÄƒng.  Máº·c dÃ¹ S. mutans lÃ  nguyÃªn nhÃ¢n chÃ­nh, nhÆ°ng viá»‡c duy trÃ¬ vá»‡ sinh rÄƒng miá»‡ng tá»‘t, háº¡n cháº¿ Äƒn Ä‘á»“ ngá»t vÃ  cÃ³ cháº¿ Ä‘á»™ Äƒn uá»‘ng lÃ nh máº¡nh cÅ©ng ráº¥t quan trá»ng Ä‘á»ƒ giáº£m nguy cÆ¡ sÃ¢u rÄƒng.  Náº¿u báº¡n cÃ³ báº¥t ká»³ tháº¯c máº¯c nÃ o khÃ¡c, Ä‘á»«ng ngáº§n ngáº¡i há»i nha!
&lt;/answer&gt;&lt;ï½œendâ–ofâ–sentenceï½œ&gt;
  </pre>

  <div id="rendered-content"></div>
</div>

<script>
  // Láº¥y ná»™i dung thÃ´
  const raw = document.getElementById('raw-content').textContent;

  // HÃ m escape HTML Ä‘á»ƒ an toÃ n khi chÃ¨n
  function escapeHtml(text) {
    const map = {
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, function(m) { return map[m]; });
  }

  // HÃ m render markdown Ä‘Æ¡n giáº£n, há»— trá»£ tiÃªu Ä‘á» vÃ  danh sÃ¡ch cÆ¡ báº£n, code inline
  function simpleMarkdownToHtml(md) {
    let html = escapeHtml(md);

    // TiÃªu Ä‘á»
    html = html.replace(/^# (.*)$/gm, '<h1>$1</h1>');
    html = html.replace(/^## (.*)$/gm, '<h2>$1</h2>');
    html = html.replace(/^### (.*)$/gm, '<h3>$1</h3>');
    html = html.replace(/^#### (.*)$/gm, '<h4>$1</h4>');

    // Danh sÃ¡ch (unordered)
    html = html.replace(/^\s*[-*+] (.*)$/gm, '<ul><li>$1</li></ul>');
    // Danh sÃ¡ch nhiá»u dÃ²ng (gá»™p láº¡i)
    html = html.replace(/(<\/ul>\s*)<ul>/g, '');

    // Danh sÃ¡ch (ordered)
    html = html.replace(/^\s*\d+\. (.*)$/gm, '<ol><li>$1</li></ol>');
    html = html.replace(/(<\/ol>\s*)<ol>/g, '');

    // Inline code
    html = html.replace(/`([^`]+)`/g, '<code>$1</code>');

    // Thay dÃ²ng má»›i báº±ng <br> trong Ä‘oáº¡n vÄƒn (cho Ä‘oáº¡n nhá»)
    html = html.replace(/\n/g, '<br>');

    return html;
  }

  // HÃ m xá»­ lÃ½ ná»™i dung theo tháº» custom
  function processContent(rawText) {
    // Loáº¡i bá» táº¥t cáº£ tháº» dáº¡ng <ï½œ...ï½œ>
    let text = rawText.replace(/<ï½œ[^ï½œ]+ï½œ>/g, '');

    // Xá»­ lÃ½ tháº» reasoning_cot: thÃ nh pháº§n toggle
    text = text.replace(/<reasoning_cot>([\s\S]*?)<\/reasoning_cot>/g, (_, content) => {
      const htmlContent = simpleMarkdownToHtml(content.trim());
      return `
      <div class="toggle-section">
        <div class="toggle-header">
          <span class="toggle-arrow closed">â–¶</span>
          <span>ğŸ§  Suy luáº­n (Reasoning)</span>
        </div>
        <div class="toggle-content closed">${htmlContent}</div>
      </div>`;
    });

    // Xá»­ lÃ½ tháº» experting cÅ©ng tÆ°Æ¡ng tá»± reasoning_cot
    text = text.replace(/<experting>([\s\S]*?)<\/experting>/g, (_, content) => {
      const htmlContent = simpleMarkdownToHtml(content.trim());
      return `
      <div class="toggle-section">
        <div class="toggle-header">
          <span class="toggle-arrow closed">â–¶</span>
          <span>ğŸ‘¨â€ğŸ”¬ ChuyÃªn gia (Expert)</span>
        </div>
        <div class="toggle-content closed">${htmlContent}</div>
      </div>`;
    });

    // Xá»­ lÃ½ tháº» answer: hiá»ƒn thá»‹ rÃµ rÃ ng, markdown chuáº©n
    text = text.replace(/<answer>([\s\S]*?)<\/answer>/g, (_, content) => {
      const htmlContent = simpleMarkdownToHtml(content.trim());
      return `<div class="answer">${htmlContent}</div>`;
    });

    return text.trim();
  }

  // GÃ¡n ná»™i dung Ä‘Ã£ xá»­ lÃ½ vÃ o div
  const renderedDiv = document.getElementById('rendered-content');
  renderedDiv.innerHTML = processContent(raw);

  // ThÃªm event toggle cho cÃ¡c section toggle
  renderedDiv.querySelectorAll('.toggle-section').forEach(section => {
    const header = section.querySelector('.toggle-header');
    const arrow = section.querySelector('.toggle-arrow');
    const content = section.querySelector('.toggle-content');

    header.addEventListener('click', () => {
      const isClosed = content.classList.contains('closed');
      if (isClosed) {
        // Má»Ÿ
        content.classList.remove('closed');
        arrow.textContent = 'â–¼';
      } else {
        // ÄÃ³ng
        content.classList.add('closed');
        arrow.textContent = 'â–¶';
      }
    });
  });
</script>
</body>
</html>
